(function(e){e.isNumeric==null&&(e.isNumeric=function(f){return f!=null&&f.constructor===Number});e.isFunction==null&&(e.isFunction=function(f){return f!=null&&f instanceof Function});var d=e(window);var b=e(document);var a={defaultConfig:{animate:false,cellW:100,cellH:100,delay:0,engine:"giot",fixSize:null,gutterX:15,gutterY:15,selector:"> div",draggable:false,sizeCache:true,rightToLeft:false,bottomToTop:false,onGapFound:function(){},onComplete:function(){},onResize:function(){},onBlockDrag:function(){},onBlockMove:function(){},onBlockDrop:function(){},onBlockReady:function(){},onBlockFinish:function(){},onBlockActive:function(){},onBlockResize:function(){}},plugin:{},totalGrid:1,transition:false,loadBlock:function(v,o){var r=o.runtime;var u=r.gutterX;var t=r.gutterY;var h=r.cellH;var s=r.cellW;var m=null;var f=e(v);var k=f.data("active");var q=f.attr("data-position");var i=parseInt(f.attr("data-fixSize"));var g=r.lastId+++"-"+r.totalGrid;if(f.hasClass("fw-float")){return}f.attr({id:g,"data-delay":v.index});if(o.animate&&this.transition){this.setTransition(v,"")}isNaN(i)&&(i=null);(i==null)&&(i=o.fixSize);var x=(i==1)?"ceil":"round";f.attr("data-height")==null&&f.attr("data-height",f.height());f.attr("data-width")==null&&f.attr("data-width",f.width());var n=1*f.attr("data-height");var p=1*f.attr("data-width");if(!o.sizeCache){v.style.width="";p=f.width();v.style.height="";n=f.height()}var j=!p?0:Math[x]((p+u)/s);var l=!n?0:Math[x]((n+t)/h);if(!i&&o.cellH=="auto"){f.width(s*j-u);v.style.height="";n=f.height();l=!n?0:Math.round((n+t)/h)}if(!i&&o.cellW=="auto"){f.height(h*l-t);v.style.width="";p=f.width();j=!p?0:Math.round((p+u)/s)}if((i!=null)&&(j>r.limitCol||l>r.limitRow)){m=null}else{l&&l<r.minHoB&&(r.minHoB=l);j&&j<r.minWoB&&(r.minWoB=j);l>r.maxHoB&&(r.maxHoB=l);j>r.maxWoB&&(r.maxWoB=j);p==0&&(j=0);n==0&&(l=0);m={resize:false,id:g,width:j,height:l,fixSize:i};if(q){q=q.split("-");m.y=1*q[0];m.x=1*q[1];m.width=i!=null?j:Math.min(j,r.limitCol-m.x);m.height=i!=null?l:Math.min(l,r.limitRow-m.y);var w=m.y+"-"+m.x+"-"+m.width+"-"+m.height;if(k){r.holes[w]={id:m.id,top:m.y,left:m.x,width:m.width,height:m.height};this.setBlock(m,o)}else{delete r.holes[w]}}}if(f.attr("data-state")==null){f.attr("data-state","init")}else{f.attr("data-state","move")}o.onBlockReady.call(v,m,o);return(q&&k)?null:m},setBlock:function(i,q){var j=q.runtime;var p=j.gutterX;var o=j.gutterY;var n=i.height;var g=i.width;var m=j.cellH;var h=j.cellW;var l=i.x;var k=i.y;if(q.rightToLeft){l=j.limitCol-l-g}if(q.bottomToTop){k=j.limitRow-k-n}var f={fixSize:i.fixSize,resize:i.resize,top:k*m,left:l*h,width:h*g-p,height:m*n-o};f.top=1*f.top.toFixed(2);f.left=1*f.left.toFixed(2);f.width=1*f.width.toFixed(2);f.height=1*f.height.toFixed(2);i.id&&(j.blocks[i.id]=f);return f},showBlock:function(l,o){var j=o.runtime;var f=o.animate&&!this.transition?"animate":"css";var i=j.blocks[l.id];var k=e(l);var m=this;var g=k.attr("data-state")!="move";var n=g?"width 0.5s, height 0.5s":"top 0.5s, left 0.5s, width 0.5s, height 0.5s, opacity 0.5s";l.delay&&clearTimeout(l.delay);if(k.hasClass("fw-float")){return}m.setTransition(l,"");l.style.position="absolute";o.onBlockActive.call(l,i,o);function h(){g&&k.attr("data-state","start");if(o.animate&&m.transition){m.setTransition(l,n)}if(!i){var p=parseInt(l.style.height)||0;var q=parseInt(l.style.width)||0;var s=parseInt(l.style.left)||0;var r=parseInt(l.style.top)||0;k[f]({left:s+q/2,top:r+p/2,width:0,height:0,opacity:0})}else{if(i.fixSize){i.height=1*k.attr("data-height");i.width=1*k.attr("data-width")}k["css"]({opacity:1,width:i.width,height:i.height});k[f]({top:i.top,left:i.left});if(k.attr("data-nested")!=null){m.nestedGrid(l,o)}}j.length-=1;o.onBlockFinish.call(l,i,o);j.length==0&&o.onComplete.call(l,i,o)}i&&i.resize&&o.onBlockResize.call(l,i,o);o.delay>0?(l.delay=setTimeout(h,o.delay*k.attr("data-delay"))):h()},nestedGrid:function(n,q){var j,m=e(n),i=q.runtime;var p=m.attr("data-gutterX")||q.gutterX;var o=m.attr("data-gutterY")||q.gutterY;var f=m.attr("data-method")||"fitZone";var k=m.attr("data-nested")||"> div";var l=m.attr("data-cellH")||q.cellH;var g=m.attr("data-cellW")||q.cellW;var h=i.blocks[n.id];if(h){j=new freewall(m);j.reset({cellH:l,cellW:g,gutterX:1*p,gutterY:1*o,selector:k,sizeCache:false});switch(f){case"fitHeight":j[f](h.height);break;case"fitWidth":j[f](h.width);break;case"fitZone":j[f](h.width,h.height);break}}},adjustBlock:function(m,h){var j=h.runtime;var k=j.gutterX;var i=j.gutterY;var g=e("#"+m.id);var f=j.cellH;var l=j.cellW;if(h.cellH=="auto"){g.width(m.width*l-k);g[0].style.height="";m.height=Math.round((g.height()+i)/f)}},adjustUnit:function(f,l,o){var n=o.gutterX;var m=o.gutterY;var h=o.runtime;var g=o.cellW;var j=o.cellH;e.isFunction(g)&&(g=g(f));g=1*g;!e.isNumeric(g)&&(g=1);e.isFunction(j)&&(j=j(l));j=1*j;!e.isNumeric(j)&&(j=1);if(e.isNumeric(f)){g<1&&(g=g*f);var k=Math.max(1,Math.floor(f/g));if(!e.isNumeric(n)){n=(f-k*g)/Math.max(1,(k-1));n=Math.max(0,n)}k=Math.floor((f+n)/g);h.cellW=(f+n)/Math.max(k,1);h.cellS=h.cellW/g;h.gutterX=n;h.limitCol=k}if(e.isNumeric(l)){j<1&&(j=j*l);var i=Math.max(1,Math.floor(l/j));if(!e.isNumeric(m)){m=(l-i*j)/Math.max(1,(i-1));m=Math.max(0,m)}i=Math.floor((l+m)/j);h.cellH=(l+m)/Math.max(i,1);h.cellS=h.cellH/j;h.gutterY=m;h.limitRow=i}if(!e.isNumeric(f)){g<1&&(g=h.cellH);h.cellW=g!=1?g*h.cellS:1;h.gutterX=n;h.limitCol=666666}if(!e.isNumeric(l)){j<1&&(j=h.cellW);h.cellH=j!=1?j*h.cellS:1;h.gutterY=m;h.limitRow=666666}},resetGrid:function(f){f.blocks={};f.length=0;f.cellH=0;f.cellW=0;f.lastId=1;f.matrix={};f.totalCol=0;f.totalRow=0},setDraggable:function(i,h){var f=false;var g={startX:0,startY:0,top:0,left:0,handle:null,onDrop:function(){},onDrag:function(){},onStart:function(){}};e(i).each(function(){var r=e.extend({},g,h);var o=r.handle||this;var q=this;var l=e(q);var k=e(o);var j=l.css("position");j!="absolute"&&l.css("position","relative");function m(s){s.stopPropagation();s=s.originalEvent;if(s.touches){f=true;s=s.changedTouches[0]}if(s.button!=2&&s.which!=3){r.onStart.call(q,s);r.startX=s.clientX;r.startY=s.clientY;r.top=parseInt(l.css("top"))||0;r.left=parseInt(l.css("left"))||0;b.bind("mouseup touchend",n);b.bind("mousemove touchmove",p)}return false}function p(s){s=s.originalEvent;f&&(s=s.changedTouches[0]);l.css({top:r.top-(r.startY-s.clientY),left:r.left-(r.startX-s.clientX)});r.onDrag.call(q,s)}function n(s){s=s.originalEvent;f&&(s=s.changedTouches[0]);r.onDrop.call(q,s);b.unbind("mouseup touchend",n);b.unbind("mousemove touchmove",p)}l.find("iframe, form, input, textarea, .ignore-drag").each(function(){e(this).on("touchstart mousedown",function(s){s.stopPropagation()})});b.unbind("mouseup touchend",n);b.unbind("mousemove touchmove",p);k.unbind("mousedown touchstart").bind("mousedown touchstart",m)})},setTransition:function(i,g){var h=i.style;var f=e(i);if(!this.transition&&f.stop){f.stop()}else{if(h.webkitTransition!=null){h.webkitTransition=g}else{if(h.MozTransition!=null){h.MozTransition=g}else{if(h.msTransition!=null){h.msTransition=g}else{if(h.OTransition!=null){h.OTransition=g}else{h.transition=g}}}}}},getFreeArea:function(p,i,k){var f=Math.min(p+k.maxHoB,k.limitRow);var g=Math.min(i+k.maxWoB,k.limitCol);var j=g;var h=f;var o=k.matrix;for(var m=p;m<h;++m){for(var n=i;n<g;++n){if(o[m+"-"+n]){(i<n&&n<j)&&(j=n)}}}for(var m=p;m<f;++m){for(var n=i;n<j;++n){if(o[m+"-"+n]){(p<m&&m<h)&&(h=m)}}}return{top:p,left:i,width:j-i,height:h-p}},setWallSize:function(h,f){var i=h.totalRow;var k=h.totalCol;var n=h.gutterY;var o=h.gutterX;var m=h.cellH;var g=h.cellW;var j=Math.max(0,g*k-o);var l=Math.max(0,m*i-n);f.attr({"data-total-col":k,"data-total-row":i,"data-wall-width":Math.ceil(j),"data-wall-height":Math.ceil(l)});if(h.limitCol<h.limitRow){!f.attr("data-height")&&f.height(Math.ceil(l))}}};var c={giot:function(v,w){var z=w.runtime,l=z.limitRow,g=z.limitCol,r=0,q=0,F=z.totalCol,D=z.totalRow,C={},o=z.holes,p=null,A=z.matrix,f=Math.max(g,l),j=null,H=null,m=g<l?1:0,E=null,t=Math.min(g,l);function n(M,J,I,s,K){for(var L=J;L<J+K;){for(var i=I;i<I+s;){A[L+"-"+i]=M;++i>F&&(F=i)}++L>D&&(D=L)}}for(var B in o){if(o.hasOwnProperty(B)){n(o[B]["id"]||true,o[B]["top"],o[B]["left"],o[B]["width"],o[B]["height"])}}for(var G=0;G<f;++G){if(!v.length){break}m?(q=G):(r=G);E=null;for(var u=0;u<t;++u){if(!v.length){break}m?(r=u):(q=u);if(z.matrix[q+"-"+r]){continue}j=a.getFreeArea(q,r,z);p=null;for(var B=0;B<v.length;++B){if(v[B].height>j.height){continue}if(v[B].width>j.width){continue}p=v.splice(B,1)[0];break}if(p==null&&w.fixSize==null){if(E&&!m&&z.minHoB>j.height){E.height+=j.height;E.resize=true;n(E.id,E.y,E.x,E.width,E.height);a.setBlock(E,w);continue}else{if(E&&m&&z.minWoB>j.width){E.width+=j.width;E.resize=true;n(E.id,E.y,E.x,E.width,E.height);a.setBlock(E,w);continue}else{for(var B=0;B<v.length;++B){if(v[B]["fixSize"]!=null){continue}p=v.splice(B,1)[0];p.resize=true;if(m){p.width=j.width;if(w.cellH=="auto"){a.adjustBlock(p,w)}p.height=Math.min(p.height,j.height)}else{p.height=j.height;p.width=Math.min(p.width,j.width)}break}}}}if(p!=null){C[p.id]={id:p.id,x:r,y:q,width:p.width,height:p.height,resize:p.resize,fixSize:p.fixSize};E=C[p.id];n(E.id,E.y,E.x,E.width,E.height);a.setBlock(E,w)}else{var H={x:r,y:q,fixSize:0};if(m){H.width=j.width;H.height=0;var k=r-1;var h=q;while(A[h+"-"+k]){A[h+"-"+r]=true;H.height+=1;h+=1}}else{H.height=j.height;H.width=0;var h=q-1;var k=r;while(A[h+"-"+k]){A[q+"-"+k]=true;H.width+=1;k+=1}}w.onGapFound(a.setBlock(H,w),w)}}}z.matrix=A;z.totalRow=D;z.totalCol=F}};window.freewall=function(j){var f=e(j);if(f.css("position")=="static"){f.css("position","relative")}var h=Number.MAX_VALUE;var m=this;a.totalGrid+=1;var o=e.extend({},a.defaultConfig);var k={blocks:{},events:{},matrix:{},holes:{},cellW:0,cellH:0,cellS:1,filter:"",lastId:0,length:0,maxWoB:0,maxHoB:0,minWoB:h,minHoB:h,running:0,gutterX:15,gutterY:15,totalCol:0,totalRow:0,limitCol:666666,limitRow:666666,currentMethod:null,currentArguments:[]};o.runtime=k;k.totalGrid=a.totalGrid;var n=document.body.style;if(!a.transition){(n.webkitTransition!=null||n.MozTransition!=null||n.msTransition!=null||n.OTransition!=null||n.transition!=null)&&(a.transition=true)}function g(r){var t=k.gutterX;var q=k.gutterY;var p=k.cellH;var u=k.cellW;var i=e(r);var s=i.find(i.attr("data-handle"));a.setDraggable(r,{handle:s[0],onStart:function(v){if(o.animate&&a.transition){a.setTransition(this,"")}i.css("z-index",9999).addClass("fw-float");o.onBlockDrag.call(r,v)},onDrag:function(z,y){var w=i.position();var B=Math.round(w.top/p);var A=Math.round(w.left/u);var x=Math.round(i.width()/u);var v=Math.round(i.height()/p);B=Math.min(Math.max(0,B),k.limitRow-v);A=Math.min(Math.max(0,A),k.limitCol-x);m.setHoles({top:B,left:A,width:x,height:v});m.refresh();o.onBlockMove.call(r,z)},onDrop:function(v){var B=i.position();var D=Math.round(B.top/p);var z=Math.round(B.left/u);var w=Math.round(i.width()/u);var G=Math.round(i.height()/p);D=Math.min(Math.max(0,D),k.limitRow-G);z=Math.min(Math.max(0,z),k.limitCol-w);i.removeClass("fw-float");i.css({zIndex:"auto",top:D*p,left:z*u});var E,C,F,A;for(C=0;C<G;++C){for(E=0;E<w;++E){F=(C+D)+"-"+(E+z);A=k.matrix[F];if(A&&A!=true){e("#"+A).removeAttr("data-position")}}}k.holes={};i.attr({"data-width":i.width(),"data-height":i.height(),"data-position":D+"-"+z});m.refresh();o.onBlockDrop.call(r,v)}})}e.extend(m,{addCustomEvent:function(i,q){var p=k.events;i=i.toLowerCase();!p[i]&&(p[i]=[]);q.eid=p[i].length;p[i].push(q);return this},appendBlock:function(p){var i=e(p).appendTo(f);var r=null;var q=[];if(k.currentMethod){i.each(function(s,t){t.index=++s;r=a.loadBlock(t,o);r&&q.push(r)});c[o.engine](q,o);a.setWallSize(k,f);k.length=i.length;i.each(function(s,t){a.showBlock(t,o);if(o.draggable||t.getAttribute("data-draggable")){g(t)}})}},appendHoles:function(p){var q=[].concat(p),s={},r;for(r=0;r<q.length;++r){s=q[r];k.holes[s.top+"-"+s.left+"-"+s.width+"-"+s.height]=s}return this},container:f,destroy:function(){var i=f.find(o.selector).removeAttr("id"),q=null,p=[];i.each(function(s,u){$item=e(u);var t=1*$item.attr("data-width")||"";var r=1*$item.attr("data-height")||"";$item.width(t).height(r).css({position:"static"})})},fillHoles:function(p){if(arguments.length==0){k.holes={}}else{var q=[].concat(p),s={},r;for(r=0;r<q.length;++r){s=q[r];delete k.holes[s.top+"-"+s.left+"-"+s.width+"-"+s.height]}}return this},filter:function(i){k.filter=i;k.currentMethod&&this.refresh();return this},fireEvent:function(q,p,t){var s=k.events;q=q.toLowerCase();if(s[q]&&s[q].length){for(var r=0;r<s[q].length;++r){s[q][r].call(this,p,t)}}return this},fitHeight:function(i){var p=f.find(o.selector).removeAttr("id"),r=null,q=[];i=i?i:f.height()||d.height();k.currentMethod=arguments.callee;k.currentArguments=arguments;a.resetGrid(k);a.adjustUnit("auto",i,o);if(k.filter){p.data("active",0);p.filter(k.filter).data("active",1)}else{p.data("active",1)}p.each(function(t,u){var s=e(u);u.index=++t;r=a.loadBlock(u,o);r&&s.data("active")&&q.push(r)});m.fireEvent("onGridReady",f,o);c[o.engine](q,o);a.setWallSize(k,f);m.fireEvent("onGridArrange",f,o);k.length=p.length;p.each(function(s,t){a.showBlock(t,o);if(o.draggable||t.getAttribute("data-draggable")){g(t)}})},fitWidth:function(p){var i=f.find(o.selector).removeAttr("id"),r=null,q=[];p=p?p:f.width()||d.width();k.currentMethod=arguments.callee;k.currentArguments=arguments;a.resetGrid(k);a.adjustUnit(p,"auto",o);if(k.filter){i.data("active",0);i.filter(k.filter).data("active",1)}else{i.data("active",1)}i.each(function(t,u){var s=e(u);u.index=++t;r=a.loadBlock(u,o);r&&s.data("active")&&q.push(r)});m.fireEvent("onGridReady",f,o);c[o.engine](q,o);a.setWallSize(k,f);m.fireEvent("onGridArrange",f,o);k.length=i.length;i.each(function(s,t){a.showBlock(t,o);if(o.draggable||t.getAttribute("data-draggable")){g(t)}})},fitZone:function(q,i){var p=f.find(o.selector).removeAttr("id"),s=null,r=[];i=i?i:f.height()||d.height();q=q?q:f.width()||d.width();k.currentMethod=arguments.callee;k.currentArguments=arguments;a.resetGrid(k);a.adjustUnit(q,i,o);if(k.filter){p.data("active",0);p.filter(k.filter).data("active",1)}else{p.data("active",1)}p.each(function(u,v){var t=e(v);v.index=++u;s=a.loadBlock(v,o);s&&t.data("active")&&r.push(s)});m.fireEvent("onGridReady",f,o);c[o.engine](r,o);a.setWallSize(k,f);m.fireEvent("onGridArrange",f,o);k.length=p.length;p.each(function(t,u){a.showBlock(u,o);if(o.draggable||u.getAttribute("data-draggable")){g(u)}})},fixPos:function(i){e(i.block).attr({"data-position":i.top+"-"+i.left});return this},fixSize:function(i){i.height!=null&&e(i.block).attr({"data-height":i.height});i.width!=null&&e(i.block).attr({"data-width":i.width});return this},prepend:function(i){f.prepend(i);k.currentMethod&&this.refresh();return this},refresh:function(){var i=arguments.length?arguments:k.currentArguments;k.currentMethod==null&&(k.currentMethod=this.fitWidth);k.currentMethod.apply(this,Array.prototype.slice.call(i,0));return this},reset:function(i){e.extend(o,i);return this},setHoles:function(p){var q=[].concat(p),s={},r;k.holes={};for(r=0;r<q.length;++r){s=q[r];k.holes[s.top+"-"+s.left+"-"+s.width+"-"+s.height]=s}return this},unFilter:function(){delete k.filter;this.refresh();return this}});f.attr("data-min-width",Math.floor(d.width()/80)*80);for(var l in a.plugin){if(a.plugin.hasOwnProperty(l)){a.plugin[l].call(m,o,f)}}d.resize(function(){if(k.running){return}k.running=1;setTimeout(function(){k.running=0;o.onResize.call(m,f)},122);f.attr("data-min-width",Math.floor(d.width()/80)*80)})};freewall.addConfig=function(f){e.extend(a.defaultConfig,f)};freewall.createEngine=function(f){e.extend(c,f)};freewall.createPlugin=function(f){e.extend(a.plugin,f)};freewall.getMethod=function(f){return a[f]}})(window.Zepto||window.jQuery);